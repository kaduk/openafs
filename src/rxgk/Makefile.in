srcdir=@srcdir@
include @TOP_OBJDIR@/src/config/Makefile.config
include @TOP_OBJDIR@/src/config/Makefile.pthread
include @TOP_OBJDIR@/src/config/Makefile.libtool

INCLS=	${TOP_INCDIR}/rx/rx.h ${TOP_INCDIR}/rx/xdr.h

LT_objs =   rxgk_client.lo rxgk_common.lo rxgk_server.lo rxgk_errs.lo

LT_deps =   $(top_builddir)/src/opr/liboafs_opr.la \
	    $(top_builddir)/src/comerr/liboafs_comerr.la \
	    $(top_builddir)/src/rx/liboafs_rx.la

all: depinstall rxgk_int.cs.c rxgk_int.ss.c rxgk_int.xdr.c rxgk_int.h ${LT_objs}

generated: \
	rxgk_errs.h rxgk_errs.c rxgk_int.cx.c rxgk_int.xdr.c rxgk_int.ss.c

depinstall: \
	${TOP_INCDIR}/rx/rxgk.h \
	${TOP_INCDIR}/rx/rxgk_errs.h \
	${TOP_INCDIR}/rx/rxgk_int.h

${TOP_INCDIR}/rx/rxgk.h: rxgk.h ${TOP_INCDIR}/rx/rxgk_errs.h \
		${TOP_INCDIR}/rx/rxgk_int.h
	${INSTALL_DATA} ${srcdir}/rxgk.h $@

${TOP_INCDIR}/rx/rxgk_errs.h: rxgk_errs.h
	${INSTALL_DATA} $? $@

${TOP_INCDIR}/rx/rxgk_int.h: rxgk_int.h
	${INSTALL_DATA} $? $@

rxgk_int.cs.c: rxgk_int.xg
	${RXGEN} -b -A -x -C -o $@ ${srcdir}/rxgk_int.xg

rxgk_int.ss.c: rxgk_int.xg
	${RXGEN} -b -A -x -S -o $@ ${srcdir}/rxgk_int.xg

rxgk_int.xdr.c: rxgk_int.xg
	${RXGEN} -b -A -x -c -o $@ ${srcdir}/rxgk_int.xg

rxgk_int.h: rxgk_int.xg
	${RXGEN} -b -A -x -h -o $@ ${srcdir}/rxgk_int.xg

rxgk_int.ss.o: rxgk_int.ss.c rxgk_int.xdr.c rxgk_int.h
rxgk_int.cs.o: rxgk_int.cs.c rxgk_int.xdr.c rxgk_int.h
rxgk_int.xdr.o: rxgk_int.xdr.c rxgk_int.h

librxgk.a: ${LT_objs}
	$(LT_LDLIB_pthread) $(LT_objs)

$(LT_objs): $(INCLS)

rxgk_errs.h: rxgk_errs.c
rxgk_errs.c: rxgk_errs.et
	$(RM) -f rxgk_errs.h rxgk_errs.c
	${COMPILE_ET} -p ${srcdir} rxgk_errs

#
# Installation targets
#
test: all

install: librxgk.a

dest: librxgk.a

#
# Misc. targets
#
clean:
	$(LT_CLEAN)
	$(RM) -f *.o *.a *.cs.c *.ss.c *.xdr.c
	$(RM) -f rxgk_int.h core AFS_component_version_number.c

include ../config/Makefile.version
