srcdir=@srcdir@
include @TOP_OBJDIR@/src/config/Makefile.config
include @TOP_OBJDIR@/src/config/Makefile.pthread
include @TOP_OBJDIR@/src/config/Makefile.libtool

INCLS=	${TOP_INCDIR}/rx/rx.h ${TOP_INCDIR}/rx/xdr.h \
	${TOP_INCDIR}/rx/rxgk.h ${TOP_INCDIR}/rx/rxgk_errs.h \
	${TOP_INCDIR}/rx/rxgk_int.h

LT_objs = rxgk_client.lo rxgk_common.lo rxgk_server.lo rxgk_errs.lo \
	rxgk_int.cs.lo rxgk_int.xdr.lo rxgk_int.ss.lo rxgk_procs.lo rxgk_util.lo \
	rxgk_crypto.lo

LT_deps =   $(top_builddir)/src/opr/liboafs_opr.la \
	    $(top_builddir)/src/comerr/liboafs_comerr.la \
	    $(top_builddir)/src/rx/liboafs_rx.la

LT_libs =   -lgssapi_krb5 ${LIB_krb5} -lk5crypto ${LIB_hcrypto}

all: depinstall rxgk_int.cs.c rxgk_int.ss.c rxgk_int.xdr.c rxgk_int.h \
	${LT_objs} rxgkd ndebug

generated: \
	rxgk_errs.h rxgk_errs.c rxgk_int.cx.c rxgk_int.xdr.c rxgk_int.ss.c

depinstall: \
	${TOP_INCDIR}/rx/rxgk.h \
	${TOP_INCDIR}/rx/rxgk_errs.h \
	${TOP_INCDIR}/rx/rxgk_int.h

${TOP_INCDIR}/rx/rxgk.h: rxgk.h ${TOP_INCDIR}/rx/rxgk_errs.h \
		${TOP_INCDIR}/rx/rxgk_int.h
	${INSTALL_DATA} ${srcdir}/rxgk.h $@

${TOP_INCDIR}/rx/rxgk_errs.h: rxgk_errs.h
	${INSTALL_DATA} $? $@

${TOP_INCDIR}/rx/rxgk_int.h: rxgk_int.h
	${INSTALL_DATA} $? $@

rxgk_int.cs.c: rxgk_int.xg
	${RXGEN} -b -A -x -C -o $@ ${srcdir}/rxgk_int.xg

rxgk_int.ss.c: rxgk_int.xg
	${RXGEN} -b -A -x -S -o $@ ${srcdir}/rxgk_int.xg

rxgk_int.xdr.c: rxgk_int.xg
	${RXGEN} -b -A -x -c -o $@ ${srcdir}/rxgk_int.xg

rxgk_int.h: rxgk_int.xg
	${RXGEN} -b -A -x -h -o $@ ${srcdir}/rxgk_int.xg

rxgk_int.ss.o: rxgk_int.ss.c rxgk_int.xdr.c rxgk_int.h
rxgk_int.cs.o: rxgk_int.cs.c rxgk_int.xdr.c rxgk_int.h
rxgk_int.xdr.o: rxgk_int.xdr.c rxgk_int.h

liboafs_rxgk.la: liboafs_rxgk.la.sym ${LT_objs} ${LT_deps}
	$(LT_LDLIB_shlib) $(LT_objs) $(LT_deps) $(LT_libs)

$(LT_objs): $(INCLS)

rxgk_errs.h: rxgk_errs.c
rxgk_errs.c: rxgk_errs.et
	$(RM) -f rxgk_errs.h rxgk_errs.c
	${COMPILE_ET} -p ${srcdir} rxgk_errs

rxgkd: ${INCLS} liboafs_rxgk.la rxgk_procs.o rxgkd.o \
		rxgk_int.ss.o rxgk_int.xdr.o rxgk_util.o rxgk_crypto.o
	$(LT_LDRULE_static) rxgkd.o rxgk_procs.o rxgk_int.ss.o rxgk_int.xdr.o \
		rxgk_util.o rxgk_crypto.o liboafs_rxgk.la ${LIB_roken} \
		-lgssapi_krb5

ndebug: ${INCLS} liboafs_rxgk.la ndebug.o rxgk_int.cs.o rxgk_int.xdr.o \
		rxgk_util.o
	$(LT_LDRULE_static) ndebug.o rxgk_int.cs.o rxgk_int.xdr.o \
		rxgk_util.o liboafs_rxgk.la -lgssapi_krb5

#
# Installation targets
#
test: all

install: liboafs_rxgk.la

dest: liboafs_rxgk.la

#
# Misc. targets
#
clean:
	$(LT_CLEAN)
	$(RM) -f *.o *.a *.cs.c *.ss.c *.xdr.c rxgkd ndebug
	$(RM) -f rxgk_int.h core AFS_component_version_number.c

include ../config/Makefile.version
